<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Akismet</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Akismet</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/lib/akismet_rb.html">
                lib/akismet.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
<a href="Akismet.html">Akismet</a>
</p>
<table>
<tr><td valign="top">Author:</td><td>David Czarnecki

</td></tr>
<tr><td valign="top">Copyright:</td><td>Copyright (c) 2005 - David Czarnecki

</td></tr>
<tr><td valign="top">License:</td><td>BSD

</td></tr>
</table>
<p>
Heavily modified for Typo by Scott Laird Then modified for GRWiFi by James
Stewart
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000010">callAkismet</a>&nbsp;&nbsp;
      <a href="#M000007">commentCheck</a>&nbsp;&nbsp;
      <a href="#M000006">hasVerifiedKey</a>&nbsp;&nbsp;
      <a href="#M000003">new</a>&nbsp;&nbsp;
      <a href="#M000004">setProxy</a>&nbsp;&nbsp;
      <a href="#M000009">submitHam</a>&nbsp;&nbsp;
      <a href="#M000008">submitSpam</a>&nbsp;&nbsp;
      <a href="#M000005">verifyAPIKey</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">STANDARD_HEADERS</td>
          <td>=</td>
          <td class="context-item-value">{     'User-Agent' =&gt; &quot;GRWiFi/2.1 | Akismet Ruby API/1.0&quot;,     'Content-Type' =&gt; 'application/x-www-form-urlencoded'</td>
        </tr>
        </table>
      </div>
    </div>



      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000003" class="method-detail">
        <a name="M000003"></a>

        <div class="method-heading">
          <a href="#M000003" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(apiKey, blog)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Create a <a href="Akismet.html#M000003">new</a> instance of the <a
href="Akismet.html">Akismet</a> class
</p>
<p>
apiKey
</p>
<pre>
  Your Akismet API key
</pre>
<p>
blog
</p>
<pre>
  The blog associated with your api key
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000003-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000003-source">
<pre>
    <span class="ruby-comment cmt"># File lib/akismet.rb, line 33</span>
33:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">apiKey</span>, <span class="ruby-identifier">blog</span>)
34:     <span class="ruby-ivar">@apiKey</span> = <span class="ruby-identifier">apiKey</span>
35:     <span class="ruby-ivar">@blog</span> = <span class="ruby-identifier">blog</span>
36:     <span class="ruby-ivar">@verifiedKey</span> = <span class="ruby-keyword kw">false</span>
37:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000007" class="method-detail">
        <a name="M000007"></a>

        <div class="method-heading">
          <a href="#M000007" class="method-signature">
          <span class="method-name">commentCheck</span><span class="method-args">(options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This is basically the core of everything. This call takes a number of
arguments and characteristics about the submitted content and then returns
a thumbs up or thumbs down. Almost everything is optional, but performance
can drop dramatically if you exclude certain elements.
</p>
<p>
user_ip (required)
</p>
<pre>
   IP address of the comment submitter.
</pre>
<p>
user_agent (required)
</p>
<pre>
   User agent information.
</pre>
<p>
referrer (note spelling)
</p>
<pre>
   The content of the HTTP_REFERER header should be sent here.
</pre>
<p>
permalink
</p>
<pre>
   The permanent location of the entry the comment was submitted to.
</pre>
<p>
comment_type
</p>
<pre>
   May be blank, comment, trackback, pingback, or a made up value like &quot;registration&quot;.
</pre>
<p>
comment_author
</p>
<pre>
   Submitted name with the comment
</pre>
<p>
comment_author_email
</p>
<pre>
   Submitted email address
</pre>
<p>
comment_author_url
</p>
<pre>
   Commenter URL.
</pre>
<p>
comment_content
</p>
<pre>
   The content that was submitted.
</pre>
<p>
Other server enviroment variables
</p>
<pre>
   In PHP there is an array of enviroment variables called $_SERVER which contains information about the web server itself as well as a key/value for every HTTP header sent with the request. This data is highly useful to Akismet as how the submited content interacts with the server can be very telling, so please include as much information as possible.
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000007-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000007-source">
<pre>
    <span class="ruby-comment cmt"># File lib/akismet.rb, line 88</span>
88:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">commentCheck</span>(<span class="ruby-identifier">options</span> = {})
89:     <span class="ruby-identifier">callAkismet</span>(<span class="ruby-value str">'comment-check'</span>, <span class="ruby-identifier">options</span>)
90:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000006" class="method-detail">
        <a name="M000006"></a>

        <div class="method-heading">
          <a href="#M000006" class="method-signature">
          <span class="method-name">hasVerifiedKey</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns <tt>true</tt> if the API key has been verified, <tt>false</tt>
otherwise
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000006-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000006-source">
<pre>
    <span class="ruby-comment cmt"># File lib/akismet.rb, line 62</span>
62:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hasVerifiedKey</span>()
63:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@verifiedKey</span>
64:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000004" class="method-detail">
        <a name="M000004"></a>

        <div class="method-heading">
          <a href="#M000004" class="method-signature">
          <span class="method-name">setProxy</span><span class="method-args">(proxyHost, proxyPort)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Set proxy information
</p>
<p>
proxyHost
</p>
<pre>
  Hostname for the proxy to use
</pre>
<p>
proxyPort
</p>
<pre>
  Port for the proxy
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000004-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000004-source">
<pre>
    <span class="ruby-comment cmt"># File lib/akismet.rb, line 45</span>
45:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setProxy</span>(<span class="ruby-identifier">proxyHost</span>, <span class="ruby-identifier">proxyPort</span>) 
46:     <span class="ruby-ivar">@proxyPort</span> = <span class="ruby-identifier">proxyPort</span>
47:     <span class="ruby-ivar">@proxyHost</span> = <span class="ruby-identifier">proxyHost</span>
48:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">
          <a href="#M000009" class="method-signature">
          <span class="method-name">submitHam</span><span class="method-args">(options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This call is intended for the marking of false positives, things that were
incorrectly marked as spam. It takes identical arguments as comment check
and submit spam. The call parameters are the same as for the <a
href="Akismet.html#M000007">commentCheck</a> method.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000009-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000009-source">
<pre>
     <span class="ruby-comment cmt"># File lib/akismet.rb, line 100</span>
100:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">submitHam</span>(<span class="ruby-identifier">options</span> = {})
101:     <span class="ruby-identifier">callAkismet</span>(<span class="ruby-value str">'submit-ham'</span>, <span class="ruby-identifier">options</span>)
102:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000008" class="method-detail">
        <a name="M000008"></a>

        <div class="method-heading">
          <a href="#M000008" class="method-signature">
          <span class="method-name">submitSpam</span><span class="method-args">(options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This call is for submitting comments that weren&#8216;t marked as spam but
should have been. It takes identical arguments as comment check. The call
parameters are the same as for the <a
href="Akismet.html#M000007">commentCheck</a> method.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000008-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000008-source">
<pre>
    <span class="ruby-comment cmt"># File lib/akismet.rb, line 94</span>
94:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">submitSpam</span>(<span class="ruby-identifier">options</span> = {})
95:     <span class="ruby-identifier">callAkismet</span>(<span class="ruby-value str">'submit-spam'</span>, <span class="ruby-identifier">options</span>)
96:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000005" class="method-detail">
        <a name="M000005"></a>

        <div class="method-heading">
          <a href="#M000005" class="method-signature">
          <span class="method-name">verifyAPIKey</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Call to check and verify your API key. You may then call the <a
href="Akismet.html#M000006">hasVerifiedKey</a> method to see if your key
has been validated.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000005-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000005-source">
<pre>
    <span class="ruby-comment cmt"># File lib/akismet.rb, line 51</span>
51:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">verifyAPIKey</span>()
52:     <span class="ruby-identifier">http</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'rest.akismet.com'</span>, <span class="ruby-value">80</span>, <span class="ruby-ivar">@proxyHost</span>, <span class="ruby-ivar">@proxyPort</span>)
53:     <span class="ruby-identifier">path</span> = <span class="ruby-value str">'/1.1/verify-key'</span>
54:     
55:     <span class="ruby-identifier">data</span>=<span class="ruby-node">&quot;key=#{@apiKey}&amp;blog=#{@blog}&quot;</span>
56:     
57:     <span class="ruby-identifier">resp</span>, <span class="ruby-identifier">data</span> = <span class="ruby-identifier">http</span>.<span class="ruby-identifier">post</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">data</span>, <span class="ruby-constant">STANDARD_HEADERS</span>)
58:     <span class="ruby-ivar">@verifiedKey</span> = (<span class="ruby-identifier">data</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;valid&quot;</span>)
59:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000010" class="method-detail">
        <a name="M000010"></a>

        <div class="method-heading">
          <a href="#M000010" class="method-signature">
          <span class="method-name">callAkismet</span><span class="method-args">(akismet_function, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <pre>
 Internal call to Akismet. Prepares the data for posting to the Akismet service.

 akismet_function
   The Akismet function that should be called
 user_ip (required)
    IP address of the comment submitter.
 user_agent (required)
    User agent information.
 referrer (note spelling)
    The content of the HTTP_REFERER header should be sent here.
 permalink
    The permanent location of the entry the comment was submitted to.
 comment_type
    May be blank, comment, trackback, pingback, or a made up value like &quot;registration&quot;.
 comment_author
    Submitted name with the comment
 comment_author_email
    Submitted email address
 comment_author_url
    Commenter URL.
 comment_content
    The content that was submitted.
 Other server enviroment variables
    In PHP there is an array of enviroment variables called $_SERVER which contains information about the web server itself as well as a key/value for every HTTP header sent with the request. This data is highly useful to Akismet as how the submited content interacts with the server can be very telling, so please include as much information as possible.
</pre>
<p>
options[:user_ip] = user_ip options[:user_agent] = user_agent
options[:referrer] = referrer options[:permalink] = permalink
options[:comment_type] = comment_type options[:comment_author] =
comment_author options[:comment_author_email] = comment_author_email
options[:comment_author_url] = comment_author_url options[:comment_content]
= comment_content
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000010-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000010-source">
<pre>
     <span class="ruby-comment cmt"># File lib/akismet.rb, line 139</span>
139:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">callAkismet</span>(<span class="ruby-identifier">akismet_function</span>, <span class="ruby-identifier">options</span> = {})
140:     <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">false</span>
141:     <span class="ruby-constant">Timeout</span>.<span class="ruby-identifier">timeout</span>(<span class="ruby-value">5</span>) <span class="ruby-keyword kw">do</span>
142:       <span class="ruby-identifier">http</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;#{@apiKey}.rest.akismet.com&quot;</span>, <span class="ruby-value">80</span>, <span class="ruby-ivar">@proxyHost</span>, <span class="ruby-ivar">@proxyPort</span>)
143:       <span class="ruby-identifier">path</span> = <span class="ruby-node">&quot;/1.1/#{akismet_function}&quot;</span>
144:   
145:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:blog</span>] = <span class="ruby-ivar">@blog</span>
146:       <span class="ruby-identifier">params</span>=[]
147:   
148:       <span class="ruby-identifier">options</span>.<span class="ruby-identifier">each_key</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
149:         <span class="ruby-identifier">params</span>.<span class="ruby-identifier">push</span> <span class="ruby-node">&quot;#{key}=#{CGI.escape(options[key].to_s)}&quot;</span>
150:       <span class="ruby-keyword kw">end</span>
151:   
152:       <span class="ruby-identifier">data</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">'&amp;'</span>)
153:       <span class="ruby-identifier">resp</span>, <span class="ruby-identifier">data</span> = <span class="ruby-identifier">http</span>.<span class="ruby-identifier">post</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">data</span>, <span class="ruby-constant">STANDARD_HEADERS</span>)
154:   
155:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">data</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'true'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">data</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'false'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">data</span> <span class="ruby-operator">==</span> <span class="ruby-value str">''</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">data</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Thanks for making the web a better place.'</span>
156:         <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;AKISMET error: #{data}&quot;</span>
157:       <span class="ruby-keyword kw">end</span>
158: 
159:       <span class="ruby-identifier">result</span> = (<span class="ruby-identifier">data</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;true&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">data</span> <span class="ruby-operator">==</span> <span class="ruby-value str">''</span>)
160:     <span class="ruby-keyword kw">end</span>
161:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
162:   <span class="ruby-comment cmt"># rescue =&gt; err</span>
163:   <span class="ruby-comment cmt">#   logger.warn &quot;AKISMET exception: #{err}&quot;</span>
164:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>